---
title: "Final Project Initial Analysis"
author: "Scott Burstein"
date: "10/21/2020"
###"Data Science and Society (Sociology 367) - Final Project"
output: html_document
---

#Configure RStudio Rmd file output format

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Load the libraries and datasets:

Kaggle Natural Disaster Dataset: https://www.kaggle.com/headsortails/us-natural-disaster-declarations

gtrendsR Package: https://cran.r-project.org/web/packages/gtrendsR/gtrendsR.pdf

```{r message=FALSE}

#---PACKAGES------  > remove "#" if package not previously installed
#install.packages("tidyverse")
library(tidyverse)
#install.packages("gtrendsR")
library(gtrendsR)
install.packages("ggthemes")
library(ggthemes)

#---DATA---------
FEMA_Declarations <- read_csv("FEMA_data/us_disaster_declarations.csv")
view(FEMA_Declarations)
M5_Subset <- read_csv("FEMA_data/us_disasters_m5.csv")
view(M5_Subset)
```
<br/><br/>

```{r FL_Hurricanes}
FL_Hurricanes <- FEMA_Declarations %>% 
  filter(incident_type == "Hurricane", incident_begin_date >= 2015, state == "FL") %>% 
  select(declaration_title) %>% 
  distinct()
  
FL_Hurricanes  
#sub(".*? ", "", FEMA_Declarations$declaration_title)
```
```{r CA_Fires}
CA_Fires <- FEMA_Declarations %>% 
  filter(incident_type == "Fire", incident_begin_date >= 2015, state == "CA") %>% 
  select(declaration_title) %>% 
  distinct()
  
CA_Fires  
```
"""
does intensity impact how much people search for it OR how does proximity to event impact search patterns...2 days or months after....
correlate each event to number of searches / intensity to search....
does proximity to event impact climate change search volume?
"""

```{r Google_Trends_Ex}
weather_data<-gtrends("weather")
```

```{r gtrends_function}

list_of_weather_events<-c("camp fire","hurricane")

finaldata<-as.data.frame(NULL)
for (i in 1:length(list_of_weather_events)){
  weather_event_gtrends <- gtrends(keyword = list_of_weather_events[i],
                     geo = "US") #add date parameter time = "today 12-m" --> find date from original file of event.Use Lubridate
  all_states_interest <- as.data.frame(weather_event_gtrends[3])
  finaldata <- rbind(finaldata, all_states_interest)
  print(i)
  Sys.sleep(5)
}
finaldata


climate_change_trend <- gtrends(keyword = "climate change",
                   geo = "US" #change location
                   ) 
climate_change_trend[1]$interest_over_time

```

```{r US_climate_change viz}

climate_search_terms <- c(
"climate change",		
"global warming",		
"fossil fuel",		
"green new deal"
)

climate_change_gtrends <- gtrends(keyword = climate_search_terms,
        geo = "US", #change to state?
        time = "today 12-m") 
#%>% summary()

climate_change_gtrends[1]$interest_over_time


US_climate_interest <- climate_change_gtrends %>% 
          .$interest_over_time %>% #not working
          glimpse()


 climate_change_plot <- US_climate_interest %>% 
  mutate_at("hits", ~ifelse(. == "<1", 0.5, .)) %>% # replace with 0.5
  mutate_at("hits", ~as.numeric(.)) %>% # convert to numeric
  # Begin ggplot
  ggplot(aes(x = date, y = hits)) +
  #geom_vline(xintercept = 1.59e+09) + #determine key dates in correct format
  geom_line(colour = "darkblue", size = 1.5) +
  facet_wrap(~keyword) +
  ggthemes::theme_economist()
 #+ annotate()
climate_change_plot
```
Resource Cited: https://martinctc.github.io/blog/vignette-google-trends-with-gtrendsr/

```{r}
search_terms <- c(
"Hurricane Michael",		
"Hurricane Dorian",		
"Hurricane Isaias",		
"Hurricane Sally"
)

output_results <- gtrends(keyword = search_terms,
        geo = "US", #change to FL
        time = "today 12-m") 
#%>% summary()

output_results[1]$interest_over_time


FL_hurr_interest <- output_results %>% 
          .$interest_over_time %>% #not working
          glimpse()

```


```{r FL_hurricane viz}

 FL_hurr_plot <- FL_hurr_interest %>% 
  mutate_at("hits", ~ifelse(. == "<1", 0.5, .)) %>% # replace with 0.5
  mutate_at("hits", ~as.numeric(.)) %>% # convert to numeric
  # Begin ggplot
  ggplot(aes(x = date, y = hits)) +
  geom_line(colour = "darkblue", size = 1.5) +
  facet_wrap(~keyword) +
  ggthemes::theme_economist()
FL_hurr_plot
```

```{r}
CA__top4_fires <- c(
"Mendocino Complex",		
"August Fire",		
"Creek Fire",		
"North Complex"
)

CA_fire_trends <- gtrends(keyword = CA__top4_fires,
        geo = "US",
        time = "today 12-m") 
#%>% summary()


CA_fire_interest <- CA_fire_trends %>% 
          .$interest_over_time %>%
          glimpse()

CA_fire_interest[1]$interest_over_time
```

```{r CA_fire viz}
 CA_fire_plot <- CA_fire_interest %>% 
  mutate_at("hits", ~ifelse(. == "<1", 0.5, .)) %>% # replace with 0.5
  mutate_at("hits", ~as.numeric(.)) %>% # convert to numeric
  # Begin ggplot
  ggplot(aes(x = date, y = hits)) +
  geom_line(colour = "dark red", size = 1.5) +
  facet_wrap(~keyword) +
  ggthemes::theme_economist()
CA_fire_plot
```

```{r}
state_date_FEMA_decs <- FEMA_Declarations %>% 
  group_by(state, date) %>% 
  count(disaster_number)
```


---
title: "Final Project Initial Analysis"
author: "Scott Burstein"
date: "10/21/2020"
###"Data Science and Society (Sociology 367) - Final Project"
output: html_document
---

#Configure RStudio Rmd file output format

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Load the libraries and datasets:

Kaggle Natural Disaster Dataset: https://www.kaggle.com/headsortails/us-natural-disaster-declarations

gtrendsR Package: https://cran.r-project.org/web/packages/gtrendsR/gtrendsR.pdf

```{r message=FALSE}
library(tidyverse)
#install.packages("gtrendsR")
library(gtrendsR)
FEMA_Declarations <- read_csv("FEMA_data/us_disaster_declarations.csv")
view(FEMA_Declarations)
M5_Subset <- read_csv("FEMA_data/us_disasters_m5.csv")
view(M5_Subset)
```
<br/><br/>

```{r FL_Hurricanes}
FL_Hurricanes <- FEMA_Declarations %>% 
  filter(incident_type == "Hurricane", incident_begin_date >= 2015, state == "FL") %>% 
  select(declaration_title) %>% 
  distinct()
  
FL_Hurricanes  
#sub(".*? ", "", FEMA_Declarations$declaration_title)
```
```{r CA_Fires}
CA_Fires <- FEMA_Declarations %>% 
  filter(incident_type == "Fire", incident_begin_date >= 2015, state == "CA") %>% 
  select(declaration_title) %>% 
  distinct()
  
CA_Fires  
```
"""
does intensity impact how much people search for it OR how does proximity to event impact search patterns...2 days or months after....
correlate each event to number of searches / intensity to search....
does proximity to event impact climate change search volume?
"""

```{r Google_Trends_Ex}
weather_data<-gtrends("weather")
weather_data
```
```{r gtrends_function}

weather_data<-gtrends("weather")

list_of_weather_events<-c("camp fire","hurricane")

finaldata<-as.data.frame(NULL)
for (i in 1:length(list_of_weather_events)){
  cf_tweets<-gtrends(keyword = list_of_weather_events[i],
                     geo = "US") #add date parameter time = "today 12-m" --> find date from original file of event.Use Lubridate
  state_tweets<-as.data.frame(cf_tweets[3])
  finaldata<-rbind(finaldata, state_tweets)
  print(i)
  Sys.sleep(5)
}



cf_tweets<-gtrends(keyword = "climate change",
                   geo = "Florida"
                   ) 


cf_tweets<-gtrends(keyword = "camp fire",
        geo = "FL") 

cf_tweets[6]

```



```{r}
search_terms <- c(
"Hurricane Michael",		
"Hurricane Dorian",		
"Hurricane Isaias",		
"Hurricane Sally"
)

output_results <- gtrends(keyword = search_terms,
        geo = "US",
        time = "today 12-m") %>% 
        summary()

FL_hurr_interest <- output_results %>% 
          .$interest_over_time %>% #not working
          glimpse()

output_results[[1]][1].$interest_over_time
```


```{r viz}
FL_hurr_interest %>% 
  mutate_at("hits", ~ifelse(. == "<1", 0.5, .)) %>% # replace with 0.5
  mutate_at("hits", ~as.numeric(.)) %>% # convert to numeric
  # Begin ggplot
  ggplot(aes(x = date, y = hits)) +
  geom_line(colour = "darkblue", size = 1.5) +
  facet_wrap(~keyword) +
  ggthemes::theme_economist() -> plot2
```

